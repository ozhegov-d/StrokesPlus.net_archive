var linesToCopy = 1;          // how many lines to copy
var goToLineBelow = false;    // set to true if you want to move cursor down after copying

var originalClip = clip.GetText() || "";

// Copy the lines on the left (3x for wrapped lines)
sp.SendModifiedVKeys([vk.LSHIFT], [vk.HOME]);
sp.SendModifiedVKeys([vk.LSHIFT], [vk.HOME]);
sp.SendModifiedVKeys([vk.LSHIFT], [vk.HOME]);
sp.SendModifiedVKeys([vk.LCONTROL], [vk.VK_C]);
sp.Sleep(20);

var leftPart = clip.GetText() || "";
var leftIsEmpty = (leftPart === originalClip);

var rightPart = "";
if (leftIsEmpty) {
    // Cursor at the beginning - copy to the end
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]); // 3x for wrapped lines

    sp.SendModifiedVKeys([vk.LCONTROL], [vk.VK_C]);
    sp.SendVKey(vk.LEFT);
    sp.Sleep(20);
    rightPart = clip.GetText() || "";
} else {
    // The cursor is not at the beginning - copy the right side
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]); // 3x for wrapped lines

    sp.SendModifiedVKeys([vk.LCONTROL], [vk.VK_C]);
    sp.SendVKey(vk.LEFT);
    sp.Sleep(20);
    var afterRight = clip.GetText() || "";

    if (afterRight === leftPart) {
        rightPart = "";
    } else {
        rightPart = afterRight;
    }
}

var firstLine = leftIsEmpty ? rightPart : (leftPart + rightPart);

if (linesToCopy === 1) {
    clip.SetText(firstLine);
} else {
    // Go to end of first line
    sp.SendVKey(vk.END);
    sp.SendVKey(vk.END);
    sp.SendVKey(vk.END);
    sp.Sleep(20);

    // Select (linesToCopy) DOWN
    for (var i = 1; i < linesToCopy; i++) {
        sp.SendModifiedVKeys([vk.LSHIFT], [vk.DOWN]);
        sp.Sleep(20);
    }

    // Shift+End to reach true end of last line
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.SendModifiedVKeys([vk.LSHIFT], [vk.END]);
    sp.Sleep(20);

    // Copy the additional part
    sp.SendModifiedVKeys([vk.LCONTROL], [vk.VK_C]);
    sp.SendVKey(vk.RIGHT);
    sp.Sleep(30);

    var additionalLines = clip.GetText() || "";
    var fullText = firstLine + additionalLines;
    clip.SetText(fullText || "");
}

// move cursor to next line after copying (you can make it be at the beginning of the line or at the end)
if (goToLineBelow) {
    sp.SendVKey(vk.END);  // ←
    sp.SendVKey(vk.END);
    sp.SendVKey(vk.END);
    sp.SendVKey(vk.DOWN); // ↓ 
    sp.SendVKey(vk.END);  // →
    sp.SendVKey(vk.END);
    sp.SendVKey(vk.END);
}
